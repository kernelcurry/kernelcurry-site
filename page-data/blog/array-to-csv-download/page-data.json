{"componentChunkName":"component---src-templates-blog-js","path":"/blog/array-to-csv-download/","result":{"data":{"site":{"siteMetadata":{"title":"KernelCurry","author":"KernelCurry"}},"markdownRemark":{"id":"90ad3e59-115f-5f07-afe1-0962a3ecf39d","excerpt":"Have you ever needed to convert a 2 dimensional array into a CSV then force a download? Well, I have, and here is how I did it: Array Everyâ€¦","html":"<p>Have you ever needed to convert a 2 dimensional array into a CSV then force a download? Well, I have, and here is how I did it:</p>\n<h3>Array</h3>\n<p>Every internal array must have the same keys. These keys may be set to null, but the key must exist. Below is a sample array that we can work with through this example.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token single-quoted-string string\">'title'</span><span class=\"token operator\">=</span><span class=\"token operator\">></span><span class=\"token single-quoted-string string\">'How to be Good at Life'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token single-quoted-string string\">'author'</span><span class=\"token operator\">=</span><span class=\"token operator\">></span><span class=\"token single-quoted-string string\">'@GRTaylor2'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token single-quoted-string string\">'url'</span><span class=\"token operator\">=</span><span class=\"token operator\">></span><span class=\"token single-quoted-string string\">'https://medium.com/better-humans/56302026d56e'</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>\n        <span class=\"token single-quoted-string string\">'title'</span><span class=\"token operator\">=</span><span class=\"token operator\">></span><span class=\"token single-quoted-string string\">'Clean URLs for Good SEO'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token single-quoted-string string\">'author'</span><span class=\"token operator\">=</span><span class=\"token operator\">></span><span class=\"token single-quoted-string string\">'@ChuckReynolds'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token single-quoted-string string\">'url'</span><span class=\"token operator\">=</span><span class=\"token operator\">></span><span class=\"token single-quoted-string string\">'http://rynoweb.com/clean-urls-good-seo/'</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<h3>Code</h3>\n<p>The code (below) takes the array (above) and converts it into a CSV string with the keys being the header row. After the string is generated, it is placed into output buffer then forced to be downloaded by the browser.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// Generate Array.</span>\n<span class=\"token variable\">$array</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span> <span class=\"token comment\">/* Array From Above */</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Clear Output Buffer</span>\n<span class=\"token function\">ob_clean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">header</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"Content-type: text/x-csv\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">header</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"Content-Transfer-Encoding: binary\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">header</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"Content-Disposition: attachment; filename=csv\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'YmdHis'</span><span class=\"token punctuation\">,</span><span class=\"token function\">strtotime</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'now'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token double-quoted-string string\">\".csv\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">header</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"Pragma: no-cache\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">header</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"Expires: 0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Generate CSV in Memory</span>\n<span class=\"token variable\">$file</span> <span class=\"token operator\">=</span> <span class=\"token function\">fopen</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'php://temp/maxmemory:'</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">(</span><span class=\"token number\">12</span><span class=\"token operator\">*</span><span class=\"token number\">1024</span><span class=\"token operator\">*</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'r+'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 128mb</span>\n\n<span class=\"token comment\">// Write CSV to memory</span>\n<span class=\"token function\">fputcsv</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">,</span> <span class=\"token function\">array_keys</span><span class=\"token punctuation\">(</span><span class=\"token function\">call_user_func_array</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'array_merge'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$array</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$csv</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token function\">fputcsv</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Fetch CSV contents</span>\n<span class=\"token function\">rewind</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$output</span> <span class=\"token operator\">=</span> <span class=\"token function\">stream_get_contents</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">fclose</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Echo CSV</span>\n<span class=\"token keyword\">echo</span> <span class=\"token variable\">$output</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Output</h3>\n<p>Once the CSV is generated, it will be downloaded. This is what the CSV file will look like:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">title,author,url\n&quot;How to be Good at Life&quot;,@GRTaylor2,https://medium.com/better-humans/56302026d56e\n&quot;Clean URLs for Good SEO&quot;,@ChuckReynolds,http://rynoweb.com/clean-urls-good-seo/</code></pre></div>\n<p>CSV output is an annoying part of reporting in PHP. Hopefully this simple solution makes it easier in the future.</p>","fields":{"readingTime":{"text":"2 min read"}},"frontmatter":{"title":"2 Dimensional Array To CSV Download Using PHP","date":"January 28, 2014","description":"Have you ever needed to convert a 2 dimensional array into a CSV then force a download?  Well, I have, and here is how I did it..."}}},"pageContext":{"slug":"/array-to-csv-download/","previous":{"fields":{"slug":"/company-hack-night/"},"frontmatter":{"title":"Every Company Should Have a #HackNight"},"parent":{"id":"511ad927-b09c-59d6-95bc-3a88c77a4b33","name":"index","sourceInstanceName":"blog"}},"next":{"fields":{"slug":"/object-oriented-wordpress-plugin/"},"frontmatter":{"title":"How To Make An Object Oriented WordPress Plugin"},"parent":{"id":"10ed45c9-eae2-50d7-88b7-3f8c5ce32eeb","name":"index","sourceInstanceName":"blog"}}}}}