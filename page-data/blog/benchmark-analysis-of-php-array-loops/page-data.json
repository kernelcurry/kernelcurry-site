{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/benchmark-analysis-of-php-array-loops/","result":{"data":{"site":{"siteMetadata":{"title":"KernelCurry","author":"KernelCurry"}},"markdownRemark":{"id":"cf99a9a2-aa13-509b-a26e-9494420e808d","excerpt":"UPDATE: Migrated from a post I wrote when working on leve.rs The last post I wrote provided examples of different ways to use array…","html":"<p><em>UPDATE:</em> Migrated from a <a href=\"https://web.archive.org/web/20140730180731/http://leve.rs:80/blog/benchmark-analysis-of-php-array-loops\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">post</a> I wrote when working on leve.rs</p>\n<hr>\n<p>The last post I wrote provided examples of different ways to use array manipulation in PHP <a href=\"https://kernelcurry.com/blog/correct-array-manipulation-in-php/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Link</a>. An amazing number of people replied with a compelling argument, saying it’s better to use a foreach statement instead of the array_walk function.</p>\n<p>As all comments I receive from my articles, I thought hard on the idea. What is the fastest way achieve the end result?</p>\n<p>I decided to take 5 different methods and use <a href=\"http://pecl.php.net/package/xhprof\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">xhprof</a> to collect runtime data. Then, I analyzed these results to determine the best method(s). All tests were executed using PHP 5.5.6 on a Macbook Air.</p>\n<h5>Methods</h5>\n<ul>\n<li>Array_walk pass by reference</li>\n<li>Array_Walk closure function</li>\n<li>Foreach</li>\n<li>For with length set before loop</li>\n<li>For with length set inline</li>\n</ul>\n<p>Each method used simple arithmetic functions to change each element in the array.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$element</span> <span class=\"token operator\">+</span><span class=\"token operator\">=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$element</span> <span class=\"token operator\">*</span><span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$element</span> <span class=\"token operator\">/</span><span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$element</span> <span class=\"token operator\">-</span><span class=\"token operator\">=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Results</h2>\n<p>Each array size tested was calculated four separate times to eliminate outliers in the dataset. A trend line was then calculated for each method.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1024px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/56c749fe6560d0c9727faa74091aba75/f4848/10000.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.34375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABcSAAAXEgFnn9JSAAABn0lEQVQoz32S6XKrMAyFef837KTTBghhh9h4305lk9yb/ikzGimy/OlIcWWtDc655L3/ZTkXQkha69T3fTFjzHnu3uqetRTDWesrCiJB8ZcRGPnCe85YA2sMQRydhWTpXGjlK6K/gEVBtlf8nstKXzEpSSckJKZkGtYp1e0X5uH2S2EuRrai4M2/YhqVvAM/OMZ5wLW+oPn+wNh+JbEtsEr7ijEWSSWe3U+APX3OZwjtCVwIjMuI+npBSzZ1V4h9gdO6jOx8gDbGVzRKfCr5B3wpEVJgmk9I3XxinDoI/oCjmhAjMiQ3dc6k4B3dMf9HLl0yyFlwvmPpW9y7b4xbDyk5NbGI9OdktYbqpVSQQoIzhX2XaZkFeXECSSr2x0pPo0VTN6jbAff7imWR2Ddd/DAcuN0Ybu1pXcfpN0dPeTpL0yzBGO0w0nfvV3xe2tTUC8ZRYtst1lVj20yBbRm6cmhtaU/5ybiykjxuCJ6msylGUm6eQOcCxCFTiAlAgpIHyV+hlKAVaDweG4Hn8h45YzSuRP6kUjiOg/LlYm7gfwBM6QQzfzjnogAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Runtime Analysis 10,000\"\n        title=\"Runtime Analysis 10,000\"\n        src=\"/static/56c749fe6560d0c9727faa74091aba75/f4848/10000.png\"\n        srcset=\"/static/56c749fe6560d0c9727faa74091aba75/f4848/10000.png 1024w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Runtime Analysis 10,000</figcaption>\n  </figure></p>\n<p>By analyzing the above graph, you will see there are 2 distinct groups: [For Inline, Array<em>Walk Reference, Array</em>Walk Closure] and [Foreach, For Outside]. Although visually there is a large difference between the two groups, there is actually only a millisecond difference in runtime. At this small of an array size, all tested methods are perfectly valid. This brings up a new question: What if the array was bigger?</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1024px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7b993242e4922cccd23dc27780068da9/f4848/1000000.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.44140625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABcSAAAXEgFnn9JSAAABdUlEQVQoz31SibKcMAzj/7+zLQsBckBusKpkYd9rp1NmNE4cR5YchpRSzTlftdY/UEq5zvO8YozXOI4drP2cfWq5fvbkKcO9wP9A4g5e/ORI3mMptaOmjBjiOTT2+1AY5Yl/r7/vKURIIjll8c7Kpl4yTT9hrK7fFcq/1D1KGmivq/H+gLYa0/wLSr1gdiORdUQdrLVtBrhV4AuRJAkll241xMiLDpMaMVONNitzoZ+xRu7mdQghfBR+zeVNkjgX6ywUL09aYXOmq8v5rfRxcI/jTfhYbl3KbW0/dqybwrK+sJmFSjwJMq6z9tjQ1bf4RifkH1H7o7TNEQ5x7L7YDWqZoLWGswH7zgYudThL29pDb54xYFEeavaMQQg4R0IRuexx4Me0yvhyvUBvtGoKCTLXAdYmzLNljqSOzQ+esUEMqY8mxv7y4PjqcPFr83BuF9qnrYtqHNZ15bx2vlyAMVStZv6Lrc72OQICH5qDveWFiTaG+hsSVQfdBgB3UAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Runtime Analysis 1,000,000&lt;\"\n        title=\"Runtime Analysis 1,000,000&lt;\"\n        src=\"/static/7b993242e4922cccd23dc27780068da9/f4848/1000000.png\"\n        srcset=\"/static/7b993242e4922cccd23dc27780068da9/f4848/1000000.png 1024w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Runtime Analysis 1,000,000&lt;</figcaption>\n  </figure></p>\n<p>Go figure; the graph looks the same! With this larger dataset, we can determine that all methods are acting in a linear fashion. Another proposition presents itself, making us ask, at what array size is using the faster group worth it?</p>\n<h5>Runtime Differences</h5>\n<p><em>Group1:</em> [For Inline, Array<em>Walk Reference, Array</em>Walk Closure]</p>\n<p><em>Group2:</em> [Foreach, For Outside]</p>\n<ul>\n<li>Size 10,000: 161,000 µs</li>\n<li>Size 500,000: 849,000 µs</li>\n<li>Size 1,000,000: 1,679,000 µs</li>\n</ul>\n<p>Just for fun, let’s take a look at a larger dataset.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1024px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ead94e4ec9381c2894e1085c4a201507/f4848/10000000.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.44140625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABcSAAAXEgFnn9JSAAABfUlEQVQoz2VSiXKFIAz0/3+z03oioHJL0g36Xm3LTCZAkmU3oYsxlpRSLaX8spxzPc+zhhBq3/fNkPuONX/vr9wqPndyACD/NRS/9wBuhtx2f8ViOwMYvvC+b2ysPp+A9DIUNHvun3eooZQL7c6RNpqm4ZOWuWfnjtLdEl6A/xj+ML3Y+BB4NZqnqWcBsXZl7x1JDHmls9bWWwq95IihdxwFCDGJH+7gRSse+g/Wy8j+2DkjLnJvJVJXOu/9W/KLzZUI1jhvYLPMA49q5O3Y2t0F8uxna4P09ZJ8S6KcmnTeveN1nRsTqxewdZCbMRgA5dQG0mruPdRQ8BE9DOU9FOmDAYN5AyP0RRvLmw2YHh7YYjNrPOsVjykH1p5nmHi1eFIq8HGAIRFV7zxPg6av3qDZjrWKbHQCYAKAB1DkaZQH0IItgUkGK8gN19cJ6H/zwZeuVvmQBYk7Ffh6VhRaVkphEDuS8YBewWaE5IyYke/BlSriDgp2mT4xlgzlG7+KB8PqlWU5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Runtime Analysis 10,000,000&lt;\"\n        title=\"Runtime Analysis 10,000,000&lt;\"\n        src=\"/static/ead94e4ec9381c2894e1085c4a201507/f4848/10000000.png\"\n        srcset=\"/static/ead94e4ec9381c2894e1085c4a201507/f4848/10000000.png 1024w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Runtime Analysis 10,000,000&lt;</figcaption>\n  </figure></p>\n<p>Again, the graph looks similar. Now we’ll take a look at the time differences!</p>\n<h5>Runtime Differences</h5>\n<p><em>Group1:</em> [For Inline, Array<em>Walk Reference, Array</em>Walk Closure]</p>\n<p><em>Group2:</em> [Foreach, For Outside]</p>\n<ul>\n<li>Size 5,000,000: 8,380,000 µs</li>\n<li>Size 10,000,000: 18,580,000 µs</li>\n</ul>\n<h2>Conclusion</h2>\n<p>With small array sizes, any method can be used with no real consequences. That being said, a decision must be made for the point at which runtime difference matters. That point – for me – would be array size of 12,000. You will have to determine what your threshold is.</p>\n<p>After analyzing the different methods, it is time for me to get into the Levers code base and clean up some things. I hope to see you on the other side, and with blazing speed!</p>\n<h2>Code</h2>\n<h4>Array Walk Reference</h4>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">function</span> <span class=\"token function\">calculate</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token variable\">$element</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$element</span> <span class=\"token operator\">+</span><span class=\"token operator\">=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$element</span> <span class=\"token operator\">*</span><span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$element</span> <span class=\"token operator\">/</span><span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$element</span> <span class=\"token operator\">-</span><span class=\"token operator\">=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">array_walk</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$subject</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">'calculate'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4>Array Walk Closure</h4>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token function\">array_walk</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$subject</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token variable\">$element</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$element</span> <span class=\"token operator\">+</span><span class=\"token operator\">=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$element</span> <span class=\"token operator\">*</span><span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$element</span> <span class=\"token operator\">/</span><span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$element</span> <span class=\"token operator\">-</span><span class=\"token operator\">=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4>For Outside</h4>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token variable\">$len</span> <span class=\"token operator\">=</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$subject</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">&lt;</span> <span class=\"token variable\">$len</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span><span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$subject</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span><span class=\"token operator\">=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$subject</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span><span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$subject</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">/</span><span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$subject</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span><span class=\"token operator\">=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>For Inline</h4>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span> <span class=\"token operator\">&lt;</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$subject</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$i</span><span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$subject</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span><span class=\"token operator\">=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$subject</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span><span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$subject</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">/</span><span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$subject</span><span class=\"token punctuation\">[</span><span class=\"token variable\">$i</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">-</span><span class=\"token operator\">=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Foreach</h4>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">foreach</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$subject</span> <span class=\"token keyword\">as</span> <span class=\"token operator\">&amp;</span><span class=\"token variable\">$element</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$element</span> <span class=\"token operator\">+</span><span class=\"token operator\">=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$element</span> <span class=\"token operator\">*</span><span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$element</span> <span class=\"token operator\">/</span><span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$element</span> <span class=\"token operator\">-</span><span class=\"token operator\">=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","fields":{"readingTime":{"text":"4 min read"}},"frontmatter":{"title":"Benchmark Analysis Of PHP Array Loops","date":"December 05, 2013","description":"I decided to take 5 different methods and use xhprof to collect runtime data. Then, I analyzed these results to determine the best method(s)."}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/benchmark-analysis-of-php-array-loops/","previous":{"fields":{"slug":"/correct-array-manipulation-in-php/"},"frontmatter":{"title":"Array Manipulation in PHP, The Correct Way"},"parent":{"id":"ceb42e14-58ea-57b4-be1f-6b83576ce20a","name":"index","sourceInstanceName":"blog"}},"next":{"fields":{"slug":"/why-you-should-use-c-with-php/"},"frontmatter":{"title":"Why You Should Use C With Php"},"parent":{"id":"07932b4f-e3f1-56b6-a6b9-7277afbee1e3","name":"index","sourceInstanceName":"blog"}}}}}