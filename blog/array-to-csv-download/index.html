<!doctype html><html lang=en><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>2 Dimensional Array To CSV Download Using PHP</title>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/normalize.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/font-fontawesome.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/font-lato.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/global.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/header.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/hero.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/blog-list.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/blog-single.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/career-list.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/career-single.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/footer.css>
</head><body><div class=header>
<div class=brand-container>
<a href=https://kernelcurry.com>KernelCurry</a>
</div>
<div class=page-nav-container>
<ul>
<li>
<a href=/blog title=Blog>Blog</a>
</li><li>
<a href=/career title=Career>Career</a>
</li><li>
<a href=/project title=Projects>Projects</a>
</li>
</ul>
</div>
<div class=social-nav-container>
<ul>
<li>
<a href=https://twitter.com/kernelcurry title rel="nofollow noopener noreferrer" target=_blank>
<i class="fa fa-twitter"></i>
</a>
</li><li>
<a href=https://github.com/michaelcurry title rel="nofollow noopener noreferrer" target=_blank>
<i class="fa fa-github"></i>
</a>
</li><li>
<a href=https://www.linkedin.com/in/michaeliancurry title rel="nofollow noopener noreferrer" target=_blank>
<i class="fa fa-linkedin"></i>
</a>
</li>
</ul>
</div>
</div><div class=main-container>
<div class=blog-single itemscope itemtype=http://schema.org/BlogPosting>
<div class=blog-hero>
<h1 itemprop=headline>2 Dimensional Array To CSV Download Using PHP</h1>
<span class=block-quote itemprop=abstract>Have you ever needed to convert a 2 dimensional array into a CSV then force a download? Well, I have, and here is how I did it...</span>
<div class=meta>
<i class="fa fa-clock-o" aria-hidden=true></i>
2 Minutes
</div>
<div class=meta>
<i class="fa fa-pencil" aria-hidden=true></i>
Published: January 28, 2014
</div>
</div>
<div class=blog-content>
<p>Have you ever needed to convert a 2 dimensional array into a CSV then force a download? Well, I have, and here is how I did it:</p>
<h3 id=array>Array</h3>
<p>Every internal array must have the same keys. These keys may be set to null, but the key must exist. Below is a sample array that we can work with through this example.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>[
    [
        <span style=color:#e6db74>&#39;title&#39;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#39;How to be Good at Life&#39;</span>,
        <span style=color:#e6db74>&#39;author&#39;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#39;@GRTaylor2&#39;</span>,
        <span style=color:#e6db74>&#39;url&#39;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#39;https://medium.com/better-humans/56302026d56e&#39;</span>
    ],
    [
        <span style=color:#e6db74>&#39;title&#39;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#39;Clean URLs for Good SEO&#39;</span>,
        <span style=color:#e6db74>&#39;author&#39;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#39;@ChuckReynolds&#39;</span>,
        <span style=color:#e6db74>&#39;url&#39;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#39;http://rynoweb.com/clean-urls-good-seo/&#39;</span>
    ]
]</code></pre></div>
<h3 id=code>Code</h3>
<p>The code (below) takes the array (above) and converts it into a CSV string with the keys being the header row. After the string is generated, it is placed into output buffer then forced to be downloaded by the browser.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#75715e>// Generate Array.
</span><span style=color:#75715e></span>$array <span style=color:#f92672>=</span> [ <span style=color:#75715e>/* Array From Above */</span> ];

<span style=color:#75715e>// Clear Output Buffer
</span><span style=color:#75715e></span><span style=color:#a6e22e>ob_clean</span>();
<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;Content-type: text/x-csv&#34;</span>);
<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;Content-Transfer-Encoding: binary&#34;</span>);
<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;Content-Disposition: attachment; filename=csv&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>date</span>(<span style=color:#e6db74>&#39;YmdHis&#39;</span>,<span style=color:#a6e22e>strtotime</span>(<span style=color:#e6db74>&#39;now&#39;</span>))<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;.csv&#34;</span>);
<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;Pragma: no-cache&#34;</span>);
<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;Expires: 0&#34;</span>);

<span style=color:#75715e>// Generate CSV in Memory
</span><span style=color:#75715e></span>$file <span style=color:#f92672>=</span> <span style=color:#a6e22e>fopen</span>(<span style=color:#e6db74>&#39;php://temp/maxmemory:&#39;</span><span style=color:#f92672>.</span> (<span style=color:#ae81ff>12</span><span style=color:#f92672>*</span><span style=color:#ae81ff>1024</span><span style=color:#f92672>*</span><span style=color:#ae81ff>1024</span>), <span style=color:#e6db74>&#39;r+&#39;</span>); <span style=color:#75715e>// 128mb
</span><span style=color:#75715e></span>
<span style=color:#75715e>// Write CSV to memory
</span><span style=color:#75715e></span><span style=color:#a6e22e>fputcsv</span>($file, <span style=color:#a6e22e>array_keys</span>(<span style=color:#a6e22e>call_user_func_array</span>(<span style=color:#e6db74>&#39;array_merge&#39;</span>, $array)));
<span style=color:#66d9ef>foreach</span>($csv <span style=color:#66d9ef>as</span> $row)
{
    <span style=color:#a6e22e>fputcsv</span>($file, $row);
}

<span style=color:#75715e>// Fetch CSV contents
</span><span style=color:#75715e></span><span style=color:#a6e22e>rewind</span>($file);
$output <span style=color:#f92672>=</span> <span style=color:#a6e22e>stream_get_contents</span>($file);
<span style=color:#a6e22e>fclose</span>($file);

<span style=color:#75715e>// Echo CSV
</span><span style=color:#75715e></span><span style=color:#66d9ef>echo</span> $output;
<span style=color:#66d9ef>die</span>();</code></pre></td></tr></table>
</div>
</div>
<h3 id=output>Output</h3>
<p>Once the CSV is generated, it will be downloaded. This is what the CSV file will look like:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>title,author,url
&#34;How to be Good at Life&#34;,@GRTaylor2,https://medium.com/better-humans/56302026d56e
&#34;Clean URLs for Good SEO&#34;,@ChuckReynolds,http://rynoweb.com/clean-urls-good-seo/</code></pre></div>
<p>CSV output is an annoying part of reporting in PHP. Hopefully this simple solution makes it easier in the future.</p>
</div>
</div>
</div><div class=footer>
<div class=footer-nav>
<ul>
<li>
<span>KernelCurry</span>
</li>
<li>
<a href=/blog title=Blog>Blog</a>
</li><li>
<a href=/career title=Career>Career</a>
</li><li>
<a href=/project title=Projects>Projects</a>
</li>
</ul>
</div>
<p>
KernelCurry &copy; <a href=http://curryisms.com/ target=_blank rel="nofollow noopener noreferrer">Copywrite</a> 2014
</p>
</div></body>
</html>