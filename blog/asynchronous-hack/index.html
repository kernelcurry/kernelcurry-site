<!doctype html><html lang=en><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Asynchronous Functions In Hack</title>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/normalize.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/font-fontawesome.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/font-lato.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/global.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/header.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/hero.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/blog-list.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/blog-single.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/career-list.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/career-single.css>
<link rel=stylesheet type=text/css href=https://kernelcurry.comcss/footer.css>
</head><body><div class=header>
<div class=brand-container>
<a href=https://kernelcurry.com>KernelCurry</a>
</div>
<div class=page-nav-container>
<ul>
<li>
<a href=/blog title=Blog>Blog</a>
</li><li>
<a href=/career title=Career>Career</a>
</li><li>
<a href=/project title=Projects>Projects</a>
</li>
</ul>
</div>
<div class=social-nav-container>
<ul>
<li>
<a href=https://twitter.com/kernelcurry title rel="nofollow noopener noreferrer" target=_blank>
<i class="fa fa-twitter"></i>
</a>
</li><li>
<a href=https://github.com/michaelcurry title rel="nofollow noopener noreferrer" target=_blank>
<i class="fa fa-github"></i>
</a>
</li><li>
<a href=https://www.linkedin.com/in/michaeliancurry title rel="nofollow noopener noreferrer" target=_blank>
<i class="fa fa-linkedin"></i>
</a>
</li>
</ul>
</div>
</div><div class=main-container>
<div class=blog-single itemscope itemtype=http://schema.org/BlogPosting>
<div class=blog-hero>
<h1 itemprop=headline>Asynchronous Functions In Hack</h1>
<span class=block-quote itemprop=abstract>The ability for PHP programs to execute asynchronous functions… Yeah, I said it and now it exists. By coding in Facebook’s new Hack Language, using your CPU’s cycles correctly has never been so easy. Let’s delve into this new language head first!</span>
<div class=meta>
<i class="fa fa-clock-o" aria-hidden=true></i>
3 Minutes
</div>
<div class=meta>
<i class="fa fa-pencil" aria-hidden=true></i>
Published: April 22, 2014
</div>
</div>
<div class=blog-content>
<p>The ability for PHP programs to execute asynchronous functions… Yeah, I said it and now it exists. By coding in Facebook’s new Hack Language, using your CPU’s cycles correctly has never been so easy. Let’s delve into this new language head first!</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#e6db74>/**
</span><span style=color:#e6db74>* This function calls async functions
</span><span style=color:#e6db74>*/</span>
<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>main</span>() <span style=color:#f92672>:</span> <span style=color:#a6e22e>void</span>
{
    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;[main] Calling Async Function&#39;</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
    $asyncCall <span style=color:#f92672>=</span> <span style=color:#a6e22e>getInfo</span>();

    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;[main] Triangulating Atlantis&#39;</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;[main] Calculating the Meaning Of Life&#39;</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;[main] Triangulating Atlantis&#39;</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;

    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;[main] Time To Request Async Return Information&#39;</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
    $output <span style=color:#f92672>=</span> $asyncCall<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>join</span>();

    <span style=color:#75715e>// Output Vector Data
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>foreach</span> ($output <span style=color:#66d9ef>as</span> $key <span style=color:#f92672>=&gt;</span> $value)
    {
        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;[&#39;</span><span style=color:#f92672>.</span>$key<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;] =&gt; &#39;</span><span style=color:#f92672>.</span>$value<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
    }
}</code></pre></td></tr></table>
</div>
</div>
<p>As can be see, this function is no different than any normal PHP function. The only thing you have to notice is the function <code>join()</code> called on line 14. This function calls the data from the asynchronous function initialized on line 7.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#e6db74>/**
</span><span style=color:#e6db74>* This async function calls more async functions
</span><span style=color:#e6db74>*
</span><span style=color:#e6db74>* @return Vector&lt;T&gt;
</span><span style=color:#e6db74>*/</span>
<span style=color:#a6e22e>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getInfo</span>() <span style=color:#f92672>:</span> <span style=color:#a6e22e>Awaitable</span><span style=color:#f92672>&amp;</span><span style=color:#a6e22e>lt</span>;<span style=color:#a6e22e>Vector</span><span style=color:#f92672>&amp;</span><span style=color:#a6e22e>lt</span>;<span style=color:#a6e22e>T</span><span style=color:#f92672>&amp;</span><span style=color:#a6e22e>gt</span>;<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>gt</span>;
{
    $info <span style=color:#f92672>=</span> <span style=color:#a6e22e>Vector</span> {};

    <span style=color:#66d9ef>for</span> ($i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; $i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>5</span>; $i<span style=color:#f92672>++</span>)
    {
        $info[] <span style=color:#f92672>=</span> <span style=color:#a6e22e>genInfo</span>($i);
    }

    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;[getInfo] Now Awaiting&#39;</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;

    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>await</span> <span style=color:#a6e22e>GenVectorWaitHandle</span><span style=color:#f92672>::</span><span style=color:#a6e22e>create</span>($info);
}</code></pre></td></tr></table>
</div>
</div>
<p>Note the async attribute of the function. This lets the compiler know the function is an asynchronous function. Secondly note the Awaitable return type. This will allow the function to use the <code>await</code> reserved word.</p>
<p>The ‘await’ token tells the function that everything preceding runs asynchronously but has to wait for $info to be completed before continuing.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#e6db74>/**
</span><span style=color:#e6db74>* This async function generates information
</span><span style=color:#e6db74>*
</span><span style=color:#e6db74>* @return String
</span><span style=color:#e6db74>*/</span>
<span style=color:#a6e22e>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>genInfo</span>(<span style=color:#a6e22e>int</span> $id)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Awaitable</span><span style=color:#f92672>&amp;</span><span style=color:#a6e22e>lt</span>;<span style=color:#a6e22e>String</span><span style=color:#f92672>&amp;</span><span style=color:#a6e22e>gt</span>; {
    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;[getInfo] Generating &#39;</span><span style=color:#f92672>.</span>$id<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;

    $tmp <span style=color:#f92672>=</span> [];
    $tmp[<span style=color:#e6db74>&#39;id&#39;</span>] <span style=color:#f92672>=</span> $id;
    $tmp[<span style=color:#e6db74>&#39;start&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>date</span>(<span style=color:#e6db74>&#39;H:i:s&#39;</span>);

    <span style=color:#a6e22e>await</span> <span style=color:#a6e22e>SleepWaitHandle</span><span style=color:#f92672>::</span><span style=color:#a6e22e>create</span>(<span style=color:#a6e22e>mt_rand</span>(<span style=color:#ae81ff>1000000</span>,<span style=color:#ae81ff>5000000</span>));

    $tmp[<span style=color:#e6db74>&#39;end&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>date</span>(<span style=color:#e6db74>&#39;H:i:s&#39;</span>);

    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;[getInfo] Completed </span><span style=color:#e6db74>$id\n</span><span style=color:#e6db74>&#34;</span>;

    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>json_encode</span>($tmp);
}</code></pre></td></tr></table>
</div>
</div>
<p>This function just sets a random time for <code>calculations</code> to be completed to simulate work that could be done. The reason this function exists is to save the start and end times of the function.</p>
<p>The last thing that must be noted about these function is the WaitHandle. This allows async function to call other functions asynchronously.</p>
<p>Below is the final output. The last 5 lines say it all!</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>[main] Calling Async Function
[getInfo] Generating 0
[getInfo] Generating 1
[getInfo] Generating 2
[getInfo] Generating 3
[getInfo] Generating 4
[getInfo] Now Awaiting
[main] Triangulating Atlantis
[main] Calculating the Meaning Of Life
[main] Triangulating Atlantis
[main] Time To Request Async Return Information
[getInfo] Completed 2
[getInfo] Completed 0
[getInfo] Completed 4
[getInfo] Completed 1
[getInfo] Completed 3
[0] =&gt; {&#34;id&#34;:0,&#34;start&#34;:&#34;22:20:34&#34;,&#34;end&#34;:&#34;22:20:36&#34;}
[1] =&gt; {&#34;id&#34;:1,&#34;start&#34;:&#34;22:20:34&#34;,&#34;end&#34;:&#34;22:20:37&#34;}
[2] =&gt; {&#34;id&#34;:2,&#34;start&#34;:&#34;22:20:34&#34;,&#34;end&#34;:&#34;22:20:35&#34;}
[3] =&gt; {&#34;id&#34;:3,&#34;start&#34;:&#34;22:20:34&#34;,&#34;end&#34;:&#34;22:20:39&#34;}
[4] =&gt; {&#34;id&#34;:4,&#34;start&#34;:&#34;22:20:34&#34;,&#34;end&#34;:&#34;22:20:36&#34;}</code></pre></div>
<p>All said and done, this is the feature that made me want to start using Hack as a production language. Even if this language crashes and burns, like too many in the past, this feature alone allows me to be hopeful for the future.</p>
<p>Github: <a href=https://github.com/kernelcurry/hack-examples/blob/master/async.php>https://github.com/kernelcurry/hack-examples/blob/master/async.php</a></p>
</div>
</div>
</div><div class=footer>
<div class=footer-nav>
<ul>
<li>
<span>KernelCurry</span>
</li>
<li>
<a href=/blog title=Blog>Blog</a>
</li><li>
<a href=/career title=Career>Career</a>
</li><li>
<a href=/project title=Projects>Projects</a>
</li>
</ul>
</div>
<p>
KernelCurry &copy; <a href=http://curryisms.com/ target=_blank rel="nofollow noopener noreferrer">Copywrite</a> 2014
</p>
</div></body>
</html>